CREATE SCHEMA HOSPITAL;

CREATE TABLE "HOSPITAL".PATIENT (
  PatientID INT PRIMARY KEY NOT NULL,
  Name VARCHAR(100) NOT NULL,
  DateOfBirth DATE NOT NULL,
  Sex VARCHAR(6) NOT NULL CHECK (Sex IN ('Male', 'Female', 'Unspecified')),
  MedicalInsurance VARCHAR(100),
  AddressStreet VARCHAR(100),
  AddressCity VARCHAR(100),
  AddressDistrict VARCHAR(100),
  EmergencyName VARCHAR(100),
  EmergencyPhone INT,
  CONSTRAINT E_CHECK CHECK (EmergencyName IS NULL OR EmergencyPhone IS NOT NULL)
);

CREATE TABLE "HOSPITAL".PATIENT_ALLERGY (
  Allergy VARCHAR(100) NOT NULL,
  PatientID INT NOT NULL,
  CONSTRAINT PA_PK PRIMARY KEY (Allergy, PatientID),
  CONSTRAINT PA_FK FOREIGN KEY (PatientID) REFERENCES "HOSPITAL".PATIENT(PatientID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".PATIENT_EMAIL (
  Email VARCHAR(100) NOT NULL,
  PatientID INT NOT NULL,
  CONSTRAINT PE_PK PRIMARY KEY (Email, PatientID),
  CONSTRAINT PE_FK FOREIGN KEY (PatientID) REFERENCES "HOSPITAL".PATIENT(PatientID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".PATIENT_PHONE (
  PhoneNumber INT NOT NULL,
  PatientID INT NOT NULL,
  CONSTRAINT PP_PK PRIMARY KEY (PhoneNumber, PatientID),
  CONSTRAINT PP_FK FOREIGN KEY (PatientID) REFERENCES "HOSPITAL".PATIENT(PatientID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".PREEXISTING_CONDITION (
  Condition VARCHAR(255) NOT NULL,
  PatientID INT NOT NULL,
  CONSTRAINT PC_PK PRIMARY KEY (Condition, PatientID),
  CONSTRAINT PC_FK FOREIGN KEY (PatientID) REFERENCES "HOSPITAL".PATIENT(PatientID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".DOCTOR (
  DoctorID INT PRIMARY KEY NOT NULL,
  Name VARCHAR(100) NOT NULL,
  MedicalExpertise VARCHAR(100) NOT NULL,
  LicenseNumber VARCHAR(50) UNIQUE NOT NULL,
  AddressStreet VARCHAR(100),
  AddressCity VARCHAR(100),
  AddressDistrict VARCHAR(100)
);

CREATE TABLE "HOSPITAL".DOCTOR_EMAIL (
  Email VARCHAR(100) NOT NULL,
  DoctorID INT NOT NULL,
  CONSTRAINT DE_PK PRIMARY KEY (Email, DoctorID),
  CONSTRAINT DE_FK FOREIGN KEY (DoctorID) REFERENCES "HOSPITAL".DOCTOR(DoctorID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".DOCTOR_PHONE (
  PhoneNumber INT NOT NULL,
  DoctorID INT NOT NULL,
  CONSTRAINT DP_PK PRIMARY KEY (PhoneNumber, DoctorID),
  CONSTRAINT DP_FK FOREIGN KEY (DoctorID) REFERENCES "HOSPITAL".DOCTOR(DoctorID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".APPOINTMENT (
  AppointmentID INT PRIMARY KEY NOT NULL,
  DateTime DATE NOT NULL,
  Reason VARCHAR(255),
  PatientID INT,
  DoctorID INT,
  CONSTRAINT A_P_FK FOREIGN KEY (PatientID) REFERENCES "HOSPITAL".PATIENT(PatientID)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT A_D_FK FOREIGN KEY (DoctorID) REFERENCES "HOSPITAL".DOCTOR(DoctorID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".TREATMENT (
  TreatmentID INT NOT NULL,
  AppointmentID INT NOT NULL,
  Diagnosis VARCHAR(255) NOT NULL,
  CONSTRAINT T_PK PRIMARY KEY (TreatmentID, AppointmentID),
  CONSTRAINT T_FK FOREIGN KEY (AppointmentID) REFERENCES "HOSPITAL".APPOINTMENT(AppointmentID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".PRESCRIPTION (
  PrescriptionID INT NOT NULL,
  TreatmentID INT NOT NULL,
  AppointmentID INT NOT NULL,
  Date DATE NOT NULL,
  DrugName VARCHAR(100) NOT NULL,
  Dosage FLOAT NOT NULL,
  Unit VARCHAR(10) NOT NULL,
  CONSTRAINT PR_PK PRIMARY KEY (PrescriptionID, TreatmentID, AppointmentID),
  CONSTRAINT PR_T_FK FOREIGN KEY (TreatmentID) REFERENCES "HOSPITAL".TREATMENT(TreatmentID)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT PR_A_FK FOREIGN KEY (AppointmentID) REFERENCES "HOSPITAL".APPOINTMENT(AppointmentID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".MEDICAL_CARE (
  Description VARCHAR(255) NOT NULL,
  TreatmentID INT NOT NULL,
  AppointmentID INT NOT NULL,
  Date DATE NOT NULL,
  CONSTRAINT MC_PK PRIMARY KEY (Description, TreatmentID, AppointmentID),
  CONSTRAINT MC_T_FK FOREIGN KEY (TreatmentID) REFERENCES "HOSPITAL".TREATMENT(TreatmentID)
    ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT MC_A_FK FOREIGN KEY (AppointmentID) REFERENCES "HOSPITAL".APPOINTMENT(AppointmentID)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "HOSPITAL".BILL (
  BillID INT NOT NULL,
  AppointmentID INT NOT NULL,
  MedicalService VARCHAR(100) NOT NULL,
  Amount FLOAT NOT NULL,
  PaymentMethod VARCHAR(15) NOT NULL CHECK (PaymentMethod IN ('Cash', 'Credit Card', 'Insurance')),
  Paid BOOLEAN NOT NULL CHECK (Paid IN (TRUE, FALSE)),
  CONSTRAINT B_PK PRIMARY KEY (BillID, AppointmentID),
  CONSTRAINT B_FK FOREIGN KEY (AppointmentID) REFERENCES "HOSPITAL".APPOINTMENT(AppointmentID)
    ON DELETE CASCADE ON UPDATE CASCADE
);
